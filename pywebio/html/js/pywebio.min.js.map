{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/handlers/base.ts","src/handlers/input.ts","src/handlers/output.ts","src/handlers/popup.ts","src/main.ts","src/models/input/actions.ts","src/models/input/base.ts","src/models/input/checkbox_radio.ts","src/models/input/file.ts","src/models/input/index.ts","src/models/input/input.ts","src/models/input/textarea.ts","src/models/output.ts","src/session.ts","src/state.ts","src/utils.ts"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","CloseHandler","this","session","close_session","_classCallCheck","accept_command","CommandDispatcher","msg","command","command2handler","handle_message","_len","arguments","handlers","Array","_key","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","h","value","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","cmd","err","return","utils_1","state_1","input_1","InputHandler","state","AutoScrollBottom","container_elem","height","$","window","body_scroll_to","focus","task_id","old_ctrl","_this","ctrls","form_ctrls","get_value","ctrl","element","show","ShowDuration","_after_show_form","move_to_top","hide","get_top","_this2","old_ctrls","target_ctrls","push","make_set","FormController","spec","append","create_element","_activate_form","console","error","dispatch_ctrl_message","deleted","pop","remove","LRUMap","that","html","Mustache","render","label","cancelable","find","on","send_message","event","data","inputs","type","body","idx","input_spec","input_items","item","name2input","name","preventDefault","each","target_name","update_input","cls","accept_input_types","all_input_items","register_inputitem","output_1","OutputHandler","OutputFixedHeight","box_scroll_to","container_parent","scroll_bottom","elem","getWidgetElement","config","outputAnimation","pos","scope","position","prepend","children","eq","insertBefore","insertAfter","fadeIn","handle_output_ctl","title","text","document","output_fixed_height","removeClass","addClass","auto_scroll_bottom","set_scope","container","old","if_exist","empty","target","removed","valid","clear","clear_before","prevAll","clear_after","scroll_to","clear_range","id","warn","parent","PopupHandler","ele","get_element","modal","mid","randomid","body_html","content","output_item","_typeof","nodes","outerHTML","closable","implicit_close","Object","assign","large","size","small","session_1","output_2","base_1","popup_1","WebIO","startWebIOClient","output_container_elem","input_container_elem","app_name","key","uri","backend_addr","URLSearchParams","location","search","get","URL","href","is_http_backend","then","http_backend","webio_session","CurrentSession","on_session_close","attr","output_ctrl","input_ctrl","popup_ctrl","close_ctrl","dispatcher","on_server_message","dispatch_message","set_up_session","HttpSession","httpPullInterval","WebSocketSession","start_session","debug","DisplayAreaButtonOnClick","Actions","InputItem","buttons","b","btn","submit_value","val","parents","trigger","attributes","index","target_value","update_input_helper","_possibleConstructorReturn","__proto__","getPrototypeOf","input_item","event_name","toLowerCase","input_idx","attr2selector","invalid_feedback","valid_feedback","help_text","attribute","class_name","input_elem","valid_status","CheckboxRadio","deep_copy","id_name_prefix","Math","floor","random","options","ignore_keys","selected","_idx","value_arr","serializeArray","res","File","id_name","placeholder","file","files","fr","FileReader","onload","data_url_value","filename","dataurl","result","log","readAsDataURL","setTimeout","bsCustomFileInput","init","actions_1","checkbox_radio_1","textarea_1","file_1","Input","Textarea","datalist","send_value_listener","multiple","CodeMirror","modeURL","codeMirrorModeURL","theme","mode","lineNumbers","indentUnit","styleActiveLine","matchBrackets","lineWrapping","k","load_codemirror_theme","code_mirror","fromTextArea","autoLoadMode","setSize","rows","head","link","url_tpl","codeMirrorThemeURL","cssId","getElementById","getElementsByTagName","createElement","rel","replace","media","appendChild","Text","handle_type","inline","lines","split","createTextNode","_md_parser","Mditor","Parser","Markdown","parse","parseHtml","html_str","parseHTML","Html","Buttons","outputSpecToHtml","this_ele","callback_id","all_widgets","blob","b64toBlob","saveAs","table_data","row_id","row","col_id","_data","span","header","slice","tdata","template","type2widget","w","callback","_on_session_create","_on_session_close","_on_server_message","ws","WebSocket","ws_api","onopen","onclose","onmessage","evt","JSON","info","closed","alert","send","stringify","_closed","close","readyState","CLOSED","CLOSING","protocol","url","pull","ajax","api_url","contentType","dataType","headers","webio-session-id","webio_session_id","success","textStatus","jqXHR","_on_request_success","interval_pull_id","setInterval","pull_interval_ms","sid","getResponseHeader","bind","clearInterval","Promise","resolve","reject","test","fail","map","keys","top_key","indexOf","splice","b64Data","sliceSize","byteCharacters","atob","byteArrays","offset","byteNumbers","charCodeAt","byteArray","Uint8Array","Blob","arr","set","obj","complete","scrollTop","top","clientHeight","speed","abs","stop","animate","min","scrollTopOffset","getBoundingClientRect","bottom","characters","charactersLength","charAt"],"mappings":"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","file":"pywebio.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import {Command, Session} from \"../session\";\n\n\nexport interface CommandHandler {\n    accept_command: string[],\n\n    handle_message(msg: Command): void\n}\n\nexport class CloseHandler implements CommandHandler {\n    accept_command: string[] = ['close_session']\n\n    constructor(readonly session: Session) {\n    }\n\n    handle_message(msg: Command) {\n        this.session.close_session();\n    }\n}\n\nexport class CommandDispatcher {\n    command2handler: { [cmd: string]: CommandHandler } = {};\n\n    constructor(...handlers: CommandHandler[]) {\n        for (let h of handlers) {\n            for (let cmd of h.accept_command) {\n                if (cmd in this.command2handler)\n                    throw  new Error(`Conflict command handler: both ${this.command2handler[cmd]} and ${h} accepts '${cmd}' command`);\n                this.command2handler[cmd] = h;\n            }\n        }\n    }\n\n    dispatch_message(msg: Command): boolean {\n        if (msg.command in this.command2handler) {\n            this.command2handler[msg.command].handle_message(msg);\n            return true;\n        }\n        return false\n    }\n}","import {Command, Session} from \"../session\";\nimport {body_scroll_to, LRUMap, make_set} from \"../utils\";\nimport {InputItem} from \"../models/input/base\"\nimport {state} from '../state'\nimport {all_input_items} from \"../models/input\"\nimport {CommandHandler} from \"./base\"\n\n/*\n* 整个输入区域的控制类\n* 管理当前活跃和非活跃的表单\n* */\nexport class InputHandler implements CommandHandler{\n    accept_command: string[] = ['input', 'input_group', 'update_input', 'destroy_form'];\n\n    session: Session;\n    private form_ctrls: LRUMap;\n    private readonly container_elem: JQuery;\n\n    constructor(session: Session, container_elem: JQuery) {\n        this.session = session;\n        this.container_elem = container_elem;\n        this.form_ctrls = new LRUMap(); // task_id -> stack of FormGroupController\n    }\n\n    private _after_show_form() {\n        if (!state.AutoScrollBottom)\n            return;\n\n        if (this.container_elem.height() > $(window).height())\n            body_scroll_to(this.container_elem, 'top', () => {\n                $('[auto_focus=\"true\"]').focus();\n            });\n        else\n            body_scroll_to(this.container_elem, 'bottom', () => {\n                $('[auto_focus=\"true\"]').focus();\n            });\n    };\n\n    // hide old_ctrls显示的表单，激活 task_id 对应的表单\n    // 需要保证 task_id 对应有表单\n    private _activate_form(task_id: string, old_ctrl: InputItem) {\n        let ctrls = this.form_ctrls.get_value(task_id);\n        let ctrl = ctrls[ctrls.length - 1];\n        if (ctrl === old_ctrl || old_ctrl === undefined) {\n            return ctrl.element.show(state.ShowDuration, () => {\n                this._after_show_form()\n            });\n        }\n        this.form_ctrls.move_to_top(task_id);\n        old_ctrl.element.hide(100, () => {\n            // ctrl.element.show(100);\n            // 需要在回调中重新获取当前前置表单元素，因为100ms内可能有变化\n            let t = this.form_ctrls.get_top();\n            if (t) t[t.length - 1].element.show(state.ShowDuration, () => {\n                this._after_show_form()\n            });\n        });\n    };\n\n\n    /*\n    * 每次函数调用返回后，this.form_ctrls.get_top()的栈顶对应的表单为当前活跃表单\n    * */\n    handle_message(msg: Command) {\n        let old_ctrls = this.form_ctrls.get_top();\n        let old_ctrl = old_ctrls && old_ctrls[old_ctrls.length - 1];\n        let target_ctrls = this.form_ctrls.get_value(msg.task_id);\n        if (target_ctrls === undefined) {\n            this.form_ctrls.push(msg.task_id, []);\n            target_ctrls = this.form_ctrls.get_value(msg.task_id);\n        }\n\n        // 创建表单\n        if (msg.command in make_set(['input', 'input_group'])) {\n            let ctrl = new FormController(this.session, msg.task_id, msg.spec);\n            target_ctrls.push(ctrl);\n            this.container_elem.append(ctrl.create_element());\n            this._activate_form(msg.task_id, old_ctrl);\n        } else if (msg.command in make_set(['update_input'])) {\n            // 更新表单\n            if (target_ctrls.length === 0) {\n                return console.error('No form to current message. task_id:%s', msg.task_id);\n            }\n            target_ctrls[target_ctrls.length - 1].dispatch_ctrl_message(msg.spec);\n            // 表单前置 removed\n            // this._activate_form(msg.task_id, old_ctrl);\n        } else if (msg.command === 'destroy_form') {\n            if (target_ctrls.length === 0) {\n                return console.error('No form to current message. task_id:%s', msg.task_id);\n            }\n            let deleted = target_ctrls.pop() as FormController;\n            if (target_ctrls.length === 0)\n                this.form_ctrls.remove(msg.task_id);\n\n            // 销毁的是当前显示的form\n            if (old_ctrls === target_ctrls) {\n                deleted.element.hide(100, () => {\n                    deleted.element.remove();\n                    let t = this.form_ctrls.get_top();\n                    if (t) t[t.length - 1].element.show(state.ShowDuration, () => {\n                        this._after_show_form()\n                    });\n                });\n            } else {\n                deleted.element.remove();\n            }\n        }\n    }\n}\n\n\n/*\n* 表单控制器\n* */\nclass FormController {\n    static input_items: { [input_type: string]: typeof InputItem } = {};\n\n    session: Session;\n\n    element: JQuery = null;\n\n    private task_id: string;\n    private spec: any;\n    // name -> input_controller\n    private name2input: { [i: string]: InputItem } = {};\n\n    public static register_inputitem(cls: typeof InputItem) {\n        for (let type of cls.accept_input_types) {\n            if (type in this.input_items)\n                throw new Error(`duplicated accept_input_types:[${type}] in ${cls} and ${this.input_items[type]}`);\n            this.input_items[type] = cls;\n        }\n    }\n\n    constructor(session: Session, task_id: string, spec: any) {\n        this.session = session;\n        this.task_id = task_id;\n        this.spec = spec;\n\n        // this.create_element();\n    }\n\n\n    create_element(): JQuery {\n        let tpl = `\n            <div class=\"card\" style=\"display: none\">\n                <h5 class=\"card-header\">{{label}}</h5>\n                <div class=\"card-body\">\n                    <form>\n                        <div class=\"input-container\"></div>\n                        <div class=\"ws-form-submit-btns\">\n                            <button type=\"submit\" class=\"btn btn-primary\">提交</button>\n                            <button type=\"reset\" class=\"btn btn-warning\">重置</button>\n                            {{#cancelable}}<button type=\"button\" class=\"pywebio_cancel_btn btn btn-danger\">取消</button>{{/cancelable}}\n                        </div>\n                    </form>\n                </div>\n            </div>`;\n        let that = this;\n\n        const html = Mustache.render(tpl, {label: this.spec.label, cancelable: this.spec.cancelable});\n        let element = $(html);\n\n        element.find('.pywebio_cancel_btn').on('click', function (e) {\n            that.session.send_message({\n                event: \"from_cancel\",\n                task_id: that.task_id,\n                data: null\n            });\n        });\n\n        // 如果表单最后一个输入元素为actions组件，则隐藏默认的\"提交\"/\"重置\"按钮\n        if (this.spec.inputs.length && this.spec.inputs[this.spec.inputs.length - 1].type === 'actions')\n            element.find('.ws-form-submit-btns').hide();\n\n        // 输入控件创建\n        let body = element.find('.input-container');\n        for (let idx in this.spec.inputs) {\n            let input_spec = this.spec.inputs[idx];\n            if (!(input_spec.type in FormController.input_items))\n                throw new Error(`Unknown input type '${input_spec.type}'`);\n            let item_class = FormController.input_items[input_spec.type];\n            let item = new item_class(this.session, this.task_id, input_spec);\n            this.name2input[input_spec.name] = item;\n\n            body.append(item.create_element());\n        }\n\n        // 事件绑定\n        element.on('submit', 'form', function (e) {\n            e.preventDefault(); // avoid to execute the actual submit of the form.\n            let data: { [i: string]: any } = {};\n            $.each(that.name2input, (name, ctrl) => {\n                data[name] = ctrl.get_value();\n            });\n            that.session.send_message({\n                event: \"from_submit\",\n                task_id: that.task_id,\n                data: data\n            });\n        });\n\n        this.element = element;\n        return element;\n    };\n\n    dispatch_ctrl_message(spec: any) {\n        if (!(spec.target_name in this.name2input)) {\n            return console.error('Can\\'t find input[name=%s] element in curr form!', spec.target_name);\n        }\n\n        this.name2input[spec.target_name].update_input(spec);\n    };\n}\n\nfor (let item of all_input_items)\n    FormController.register_inputitem(item);","import {Command, Session} from \"../session\";\nimport {config, state} from '../state'\nimport {body_scroll_to, box_scroll_to} from \"../utils\";\n\nimport {getWidgetElement} from \"../models/output\"\nimport {CommandHandler} from \"./base\";\n\n\nexport class OutputHandler implements CommandHandler {\n    session: Session;\n\n    accept_command = ['output', 'output_ctl'];\n\n    private readonly container_parent: JQuery;\n    private readonly container_elem: JQuery;\n\n    constructor(session: Session, container_elem: JQuery) {\n        this.session = session;\n        this.container_elem = container_elem;\n        this.container_parent = this.container_elem.parent();\n    }\n\n    scroll_bottom() {\n        // 固定高度窗口滚动\n        if (state.OutputFixedHeight)\n            box_scroll_to(this.container_elem, this.container_parent, 'bottom', undefined, 30);\n        // 整个页面自动滚动\n        body_scroll_to(this.container_parent, 'bottom');\n    };\n\n    handle_message(msg: Command) {\n        let scroll_bottom = false;\n        if (msg.command === 'output') {\n            let elem;\n            try {\n                elem = getWidgetElement(msg.spec);\n            } catch (e) {\n                return console.error(`Handle command error, command: ${msg}, error:${e}`);\n            }\n\n            if (config.outputAnimation) elem.hide();\n            let container_elem = this.container_elem.find(`#${msg.spec.scope || 'pywebio-scope-ROOT'}`);\n            if (container_elem.length === 0)\n                return console.error(`Scope '${msg.spec.scope}' not found`);\n\n            if (!msg.spec.scope || msg.spec.scope === 'pywebio-scope-ROOT') scroll_bottom = true;\n\n            if (msg.spec.position === 0)\n                container_elem.prepend(elem);\n            else if (msg.spec.position === -1)\n                container_elem.append(elem);\n            else {\n                let pos = $(container_elem[0].children).eq(msg.spec.position);\n                if (msg.spec.position >= 0)\n                    elem.insertBefore(pos);\n                else\n                    elem.insertAfter(pos);\n            }\n\n            if (config.outputAnimation) elem.fadeIn();\n        } else if (msg.command === 'output_ctl') {\n            this.handle_output_ctl(msg);\n        }\n        // 当设置了AutoScrollBottom、并且当前输出输出到页面末尾时，滚动到底部\n        if (state.AutoScrollBottom && scroll_bottom)\n            this.scroll_bottom();\n    };\n\n    handle_output_ctl(msg: Command) {\n        if (msg.spec.title) {\n            $('#title').text(msg.spec.title);  // 直接使用#title不规范 todo\n            document.title = msg.spec.title;\n        }\n        if (msg.spec.output_fixed_height !== undefined) {\n            state.OutputFixedHeight = msg.spec.output_fixed_height;\n            if (msg.spec.output_fixed_height)\n                $('.container').removeClass('no-fix-height');  // todo 不规范\n            else\n                $('.container').addClass('no-fix-height');  // todo 不规范\n        }\n        if (msg.spec.auto_scroll_bottom !== undefined)\n            state.AutoScrollBottom = msg.spec.auto_scroll_bottom;\n        if (msg.spec.set_scope !== undefined) {\n            let spec = msg.spec as {\n                set_scope: string, // scope名\n                container: string, // 此scope的父scope\n                position: number, // 在父scope中创建此scope的位置 0 -> 在父scope的顶部创建, -1 -> 在父scope的尾部创建\n                if_exist: string // 已经存在 ``name`` scope 时如何操作:  `'remove'` 表示先移除旧scope再创建新scope， `'none'` 表示不进行任何操作, `'clear'` 表示将旧scope的内容清除，不创建新scope\n            };\n\n            let container_elem = $(`#${spec.container}`);\n            if (container_elem.length === 0)\n                return console.error(`Scope '${msg.spec.scope}' not found`);\n\n            let old = this.container_elem.find(`#${spec.set_scope}`);\n            if (old.length) {\n                if (spec.if_exist == 'none')\n                    return;\n                else if (spec.if_exist == 'remove')\n                    old.remove();\n                else if (spec.if_exist == 'clear') {\n                    old.empty();\n                    return;\n                }\n            }\n\n            let html = `<div id=\"${spec.set_scope}\"></div>`;\n            if (spec.position === 0)\n                container_elem.prepend(html);\n            else if (spec.position === -1)\n                container_elem.append(html);\n            else {\n                if (spec.position >= 0)\n                    $(`#${spec.container}>*`).eq(spec.position).insertBefore(html);\n                else\n                    $(`#${spec.container}>*`).eq(spec.position).insertAfter(html);\n            }\n        }\n        if (msg.spec.clear !== undefined)\n            this.container_elem.find(`#${msg.spec.clear}`).empty();\n        if (msg.spec.clear_before !== undefined)\n            this.container_elem.find(`#${msg.spec.clear_before}`).prevAll().remove();\n        if (msg.spec.clear_after !== undefined)\n            this.container_elem.find(`#${msg.spec.clear_after}~*`).remove();\n        if (msg.spec.scroll_to !== undefined) {\n            let target = $(`#${msg.spec.scroll_to}`);\n            if (!target.length) {\n                console.error(`Scope ${msg.spec.scroll_to} not found`);\n            } else if (state.OutputFixedHeight) {\n                box_scroll_to(target, this.container_parent, msg.spec.position);\n            } else {\n                body_scroll_to(target, msg.spec.position);\n            }\n        }\n        if (msg.spec.clear_range !== undefined) {\n            if (this.container_elem.find(`#${msg.spec.clear_range[0]}`).length &&\n                this.container_elem.find(`#${msg.spec.clear_range[1]}`).length) {\n                let removed: HTMLElement[] = [];\n                let valid = false;\n                this.container_elem.find(`#${msg.spec.clear_range[0]}~*`).each(function () {\n                    if (this.id === msg.spec.clear_range[1]) {\n                        valid = true;\n                        return false;\n                    }\n                    removed.push(this);\n                    // $(this).remove();\n                });\n                if (valid)\n                    $(removed).remove();\n                else\n                    console.warn(`clear_range not valid: can't find ${msg.spec.clear_range[1]} after ${msg.spec.clear_range[0]}`);\n            }\n        }\n        if (msg.spec.remove !== undefined)\n            this.container_elem.find(`#${msg.spec.remove}`).remove();\n    };\n\n}\n","import {Command, Session} from \"../session\";\nimport {randomid} from \"../utils\";\n\nimport {getWidgetElement} from \"../models/output\"\nimport {CommandHandler} from \"./base\";\n\n\nexport class PopupHandler implements CommandHandler{\n    session: Session;\n\n    accept_command = ['popup', 'close_popup'];\n\n    private body = $('body');\n\n    constructor(session: Session) {\n        this.session = session;\n    }\n\n    handle_message(msg: Command) {\n        if (msg.command == 'popup') {\n            let ele = PopupHandler.get_element(msg.spec);\n            this.body.append(ele);\n            ele.on('hidden.bs.modal', function (e) {\n                ele.remove();\n            });\n            // @ts-ignore\n            ele.modal('show');\n        } else if (msg.command == 'close_popup') {\n            // @ts-ignore\n            $('.modal').modal('hide');\n        }\n    }\n\n    static get_element(spec: { title: string, content: any[], closable: boolean, implicit_close: boolean, size: string }) {\n        // https://v4.bootcss.com/docs/components/modal/#options\n        const tpl = `<div class=\"modal fade\" {{^implicit_close}}data-backdrop=\"static\"{{/implicit_close}} aria-labelledby=\"model-id-{{ mid }}\" tabindex=\"-1\" role=\"dialog\" aria-hidden=\"true\">\n          <div class=\"modal-dialog modal-dialog-scrollable {{#large}}modal-lg{{/large}} {{#small}}modal-sm{{/small}}\" role=\"document\">\n            <div class=\"modal-content\">\n              <div class=\"modal-header\">\n                <h5 class=\"modal-title\" id=\"model-id-{{ mid }}\">{{ title }}</h5>\n                {{#closable}}\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                  <span aria-hidden=\"true\">&times;</span>\n                </button>\n                {{/closable}}\n              </div>\n              <div class=\"modal-body markdown-body\">\n                {{& content }}\n              </div>\n              <!--  \n              <div class=\"modal-footer\">\n                <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n                <button type=\"button\" class=\"btn btn-primary\">Submit</button>\n              </div> \n              -->\n            </div>\n          </div>\n        </div>`;\n        let mid = randomid(10);\n\n        let body_html = '';\n\n        for (let output_item of spec.content) {\n            if (typeof output_item === 'object') {\n                try {\n                    let nodes = getWidgetElement(output_item);\n                    for (let node of nodes)\n                        body_html += node.outerHTML || '';\n                } catch (e) {\n                    console.error('Get widget html error,', e, output_item);\n                }\n            } else {\n                body_html += output_item;\n            }\n        }\n\n        if (!spec.closable)\n            spec.implicit_close = false;\n\n        let html = Mustache.render(tpl, {\n            ...spec,  // 字段： content, title, size, implicit_close, closable\n            large: spec.size == 'large',\n            small: spec.size == 'small',\n            mid: mid,\n            content: body_html,\n        });\n        return $(html as string);\n    }\n\n}","import {config as appConfig, state} from \"./state\";\nimport {Command, HttpSession, is_http_backend, Session, WebSocketSession} from \"./session\";\nimport {InputHandler} from \"./handlers/input\"\nimport {OutputHandler} from \"./handlers/output\"\nimport {DisplayAreaButtonOnClick} from \"./models/output\"\nimport {CloseHandler, CommandDispatcher} from \"./handlers/base\"\nimport {PopupHandler} from \"./handlers/popup\";\n\n// 获取后端API地址\nfunction get_backend_addr() {\n    const url = new URLSearchParams(window.location.search);\n    let uri = url.get('pywebio_api') || './io';\n    return new URL(uri, window.location.href).href;\n}\n\n// 初始化Handler和Session\nfunction set_up_session(webio_session: Session, output_container_elem: JQuery, input_container_elem: JQuery) {\n    state.CurrentSession = webio_session;\n    webio_session.on_session_close(function () {\n        $('#favicon32').attr('href', 'data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAByElEQVRYR82XLUzDUBDH/9emYoouYHAYMGCAYJAYEhxiW2EOSOYwkKBQKBIwuIUPN2g7gSPBIDF8GWbA4DAjG2qitEfesi6lbGxlXd5q393/fr333t07QpdfPp8f0nV9CcACEU0DGAOgN9yrAN6Y+QnATbVavcrlcp/dSFMnI9M0J1RV3WHmFQCJTvaN9RoRXbiuu28YxstfPm0BbNtOMPMeEW0C0LoMHDZzmPmIiHbT6XStlUZLgEKhMK5p2iWAyX8GDruVHMdZzmazr+GFXwCmac4oinINYCSm4L5M2fO8RcMwHoO6PwAaf37bh+BNCMdx5oOZaAKIPQdwF2Pa2yWwBGDOPxNNAMuyDohoK+a0t5Rj5sNMJrMtFusA4qopivLcw2mPyu14njclrmgdoFgsnjLzWlSVXuyJ6CyVSq2TqHDJZPI9QpHpJW7Qt1apVEbJsqwVIjqPSzWKDjOvCoBjItqI4hiXLTOfkG3b9wBm4xKNqPMgAMoAhiM6xmX+IQC+AKhxKUbUcQcCQPoWyD2E0q+h9EIkvRRLb0YD0Y4FhNQHiQCQ/iQTEFIfpX4Nl/os9yGkDiY+hNTRLNhSpQ2n4b7er/H8G7N6BRSbHvW5AAAAAElFTkSuQmCC');\n        $('#favicon16').attr('href', 'data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA0ElEQVQ4T62TPQrCQBCF30tA8BZW9mJtY+MNEtKr2HkWK0Xtw+4NbGysxVorbyEKyZMNRiSgmJ/tZufNNzO7M0ThxHHc8zxvSnIIoPNyXyXt0zRdR1F0+gxhblhr25IWJMcA3vcFviRtSc6DILg5XyZ0wQB2AAbFir7YBwAjB8kAxpg1ycmfwZlM0iYMwyldz77vH3+U/Y2rJEn6NMYsSc7KZM+1kla01p4BdKsAAFwc4A6gVRHwaARQr4Xaj1j7G2sPUiOjnEMqL9PnDJRd5ycpJXsd2f2NIAAAAABJRU5ErkJggg==');\n    });\n\n    let output_ctrl = new OutputHandler(webio_session, output_container_elem);\n    let input_ctrl = new InputHandler(webio_session, input_container_elem);\n    let popup_ctrl = new PopupHandler(webio_session);\n    let close_ctrl = new CloseHandler(webio_session);\n\n    let dispatcher = new CommandDispatcher(output_ctrl, input_ctrl, popup_ctrl, close_ctrl);\n\n    webio_session.on_server_message((msg: Command) => {\n        let ok = dispatcher.dispatch_message(msg);\n        if (!ok)\n            console.error('Unknown command:%s', msg.command);\n    });\n}\n\nfunction startWebIOClient(output_container_elem: JQuery, input_container_elem: JQuery, app_name: string, config: { [name: string]: any }) {\n    for (let key in config) {\n        // @ts-ignore\n        appConfig[key] = config[key];\n    }\n    const backend_addr = get_backend_addr();\n    is_http_backend(backend_addr).then(function (http_backend) {\n        let session;\n        if (http_backend)\n            session = new HttpSession(backend_addr, app_name, appConfig.httpPullInterval);\n        else\n            session = new WebSocketSession(backend_addr, app_name);\n        set_up_session(session, output_container_elem, input_container_elem);\n        session.start_session(appConfig.debug);\n    });\n\n}\n\n// @ts-ignore\nwindow.WebIO = {\n    'startWebIOClient': startWebIOClient,\n    'DisplayAreaButtonOnClick': DisplayAreaButtonOnClick,\n};","import {Session} from \"../../session\";\nimport {InputItem} from \"./base\";\n\nconst buttons_tpl = `\n<div class=\"form-group\">\n    {{#label}}<label>{{label}}</label>  <br> {{/label}} \n    {{#buttons}}\n    <button type=\"{{btn_type}}\" data-type=\"{{type}}\" value=\"{{value}}\" aria-describedby=\"{{name}}_help\" {{#disabled}}disabled{{/disabled}} class=\"btn btn-primary\">{{label}}</button>\n    {{/buttons}}\n    <div class=\"invalid-feedback\">{{invalid_feedback}}</div>  <!-- input 添加 is-invalid 类 -->\n    <div class=\"valid-feedback\">{{valid_feedback}}</div> <!-- input 添加 is-valid 类 -->\n    <small id=\"{{name}}_help\" class=\"form-text text-muted\">{{help_text}}</small>\n</div>`;\n\nexport class Actions extends InputItem {\n    static accept_input_types: string[] = [\"actions\"];\n\n    submit_value: string = null; // 提交表单时按钮组的value\n\n    constructor(session: Session, task_id: string, spec: any) {\n        super(session, task_id, spec);\n    }\n\n    create_element(): JQuery {\n        for (let b of this.spec.buttons) b['btn_type'] = b.type === \"submit\" ? \"submit\" : \"button\";\n\n        const html = Mustache.render(buttons_tpl, this.spec);\n        this.element = $(html);\n\n        let that = this;\n        this.element.find('button').on('click', function (e) {\n            let btn = $(this);\n            if (btn.data('type') === 'submit') {\n                that.submit_value = btn.val() as string;\n                // 不可以使用 btn.parents('form').submit()， 会导致input 的required属性失效\n            } else if (btn.data('type') === 'reset') {\n                btn.parents('form').trigger(\"reset\");\n            } else if (btn.data('type') === 'cancel') {\n                that.session.send_message({\n                    event: \"from_cancel\",\n                    task_id: that.task_id,\n                    data: null\n                });\n            } else {\n                console.error(\"`actions` input: unknown button type '%s'\", btn.data('type'));\n            }\n        });\n\n        return this.element;\n    }\n\n    update_input(spec: any): any {\n        let attributes = spec.attributes;\n        let idx = -1;\n        if ('target_value' in spec) {\n            this.element.find('button').each(function (index) {\n                if ($(this).val() === spec.target_value) {\n                    idx = index;\n                    return false;\n                }\n            });\n        }\n        this.update_input_helper(idx, attributes);\n    }\n\n    get_value(): any {\n        return this.submit_value;\n    }\n}\n\n\n\n","import {Session} from \"../../session\";\n\nexport class InputItem {\n    static accept_input_types: string[] = [];\n\n    session: Session;\n    task_id: string;\n    spec: any;\n\n    element: JQuery = null; // 在 create_element() 时赋值\n\n    constructor(session: Session, task_id: string, spec: any) {\n        this.session = session;\n        this.task_id = task_id;\n        this.spec = spec;\n    }\n\n    create_element(): JQuery {\n        throw new Error(\"Not implement!\");\n    }\n\n    update_input(spec: any): any {\n        throw new Error(\"Not implement!\");\n    }\n\n    get_value(): any {\n        throw new Error(\"Not implement!\");\n    }\n\n    protected send_value_listener(input_item: this, event: { type: string }) {\n        // let this_elem = $(this);\n        input_item.session.send_message({\n            event: \"input_event\",\n            task_id: input_item.task_id,\n            data: {\n                event_name: event.type.toLowerCase(),\n                name: input_item.spec.name,\n                value: input_item.get_value()\n            }\n        });\n    };\n\n    /*\n    * input_idx: 更新作用对象input标签的索引, -1 为不指定对象\n    * attributes：更新值字典\n    * */\n    protected update_input_helper(input_idx: number, attributes: { [i: string]: any }) {\n        let attr2selector: { [i: string]: string } = {\n            'invalid_feedback': 'div.invalid-feedback',\n            'valid_feedback': 'div.valid-feedback',\n            'help_text': 'small.text-muted'\n        };\n        for (let attribute in attr2selector) {\n            if (attribute in attributes) {\n                if (input_idx === -1)\n                    this.element.find(attr2selector[attribute]).text(attributes[attribute]);\n                else\n                    this.element.find(attr2selector[attribute]).eq(input_idx).text(attributes[attribute]);\n                delete attributes[attribute];\n            }\n        }\n        let input_elem = this.element.find('input,select,textarea');\n        if (input_idx >= 0)\n            input_elem = input_elem.eq(input_idx);\n\n        if ('valid_status' in attributes) {\n            let class_name = attributes.valid_status ? 'is-valid' : 'is-invalid';\n            input_elem.removeClass('is-valid is-invalid').addClass(class_name);\n            delete attributes.valid_status;\n        }\n        input_elem.attr(attributes);\n    }\n}\n\n\n\n","import {Session} from \"../../session\";\nimport {InputItem} from \"./base\";\nimport {deep_copy} from \"../../utils\"\n\nconst checkbox_radio_tpl = `\n<div class=\"form-group\">\n    {{#label}}<label>{{label}}</label>{{/label}}\n    {{#inline}}<br>{{/inline}}\n    {{#options}}\n    <div class=\"form-check {{#inline}}form-check-inline{{/inline}}\">\n        <input type=\"{{type}}\" id=\"{{id_name_prefix}}-{{idx}}\" name=\"{{name}}\" value=\"{{value}}\" {{#selected}}checked{{/selected}} {{#disabled}}disabled{{/disabled}} class=\"form-check-input\">\n        <label class=\"form-check-label\" for=\"{{id_name_prefix}}-{{idx}}\">\n            {{label}}\n        </label>\n        <div class=\"invalid-feedback\">{{invalid_feedback}}</div>  <!-- input 添加 is-invalid 类 -->\n        <div class=\"valid-feedback\">{{valid_feedback}}</div> <!-- input 添加 is-valid 类 -->\n    </div>\n    {{/options}}\n    <small id=\"{{id_name}}_help\" class=\"form-text text-muted\">{{help_text}}</small>\n</div>`;\n\nexport class CheckboxRadio extends InputItem {\n    static accept_input_types: string[] = [\"checkbox\", \"radio\"];\n\n    constructor(session: Session, task_id: string, spec: any) {\n        super(session, task_id, spec);\n    }\n\n    create_element(): JQuery {\n        let spec = deep_copy(this.spec);\n        const id_name_prefix = spec.name + '-' + Math.floor(Math.random() * Math.floor(9999));\n        spec['id_name_prefix'] = id_name_prefix;\n        for (let idx in spec.options) {\n            spec.options[idx]['idx'] = idx;\n        }\n        const html = Mustache.render(checkbox_radio_tpl, spec);\n        let elem = $(html);\n        this.element = elem;\n\n        const ignore_keys = {'value': '', 'label': '', 'selected': ''};\n        for (let idx = 0; idx < this.spec.options.length; idx++) {\n            let input_elem = elem.find('#' + id_name_prefix + '-' + idx);\n            // blur事件时，发送当前值到服务器\n            // checkbox_radio 不产生blur事件\n            // input_elem.on('blur', this.send_value_listener);\n\n            // 将额外的html参数加到input标签上\n            for (let key in this.spec.options[idx]) {\n                if (key in ignore_keys) continue;\n                input_elem.attr(key, this.spec.options[idx][key]);\n            }\n        }\n        return this.element;\n    }\n\n    update_input(spec: any): any {\n        let attributes = spec.attributes;\n        let idx = -1;\n        if ('target_value' in spec) {\n            this.element.find('input').each(function (index) {\n                if ($(this).val() === spec.target_value) {\n                    idx = index;\n                    return false;\n                }\n            });\n        }\n        this.update_input_helper(idx, attributes);\n    }\n\n    get_value(): any {\n        if (this.spec.type === 'radio') {\n            return this.element.find('input:checked').val() || '';\n        } else {\n            let value_arr = this.element.find('input').serializeArray();\n            let res: string[] = [];\n            let that = this;\n            $.each(value_arr, function (idx, val) {\n                if (val.name === that.spec.name)\n                    res.push(val.value);\n            });\n            return res;\n        }\n    }\n}\n\n\n\n","import {Session} from \"../../session\";\nimport {InputItem} from \"./base\";\nimport {deep_copy} from \"../../utils\"\nimport {state} from \"../../state\";\n\nconst file_input_tpl = `\n<div class=\"form-group\">\n    {{#label}}<label for=\"{{id_name}}\">{{label}}</label>{{/label}}\n    <div class=\"custom-file\">\n        <input type=\"file\" name=\"{{name}}\" class=\"custom-file-input\" id=\"{{id_name}}\" aria-describedby=\"{{id_name}}_help\">\n        <label class=\"custom-file-label\" for=\"{{id_name}}\">{{placeholder}}</label>\n        <div class=\"invalid-feedback\">{{invalid_feedback}}</div>  <!-- input 添加 is-invalid 类 -->\n        <div class=\"valid-feedback\">{{valid_feedback}}</div> <!-- input 添加 is-valid 类 -->\n        <small id=\"{{id_name}}_help\"  class=\"form-text text-muted\">{{help_text}}</small>\n    </div>\n</div>`;\n\nexport class File extends InputItem {\n    static accept_input_types: string[] = [\"file\"];\n\n    data_url_value: { filename: string, dataurl: string } = null; // 待上传文件信息\n\n    constructor(session: Session, task_id: string, spec: any) {\n        super(session, task_id, spec);\n    }\n\n    create_element(): JQuery {\n        let spec = deep_copy(this.spec);\n        const id_name = spec.name + '-' + Math.floor(Math.random() * Math.floor(9999));\n        spec['id_name'] = id_name;\n\n        const html = Mustache.render(file_input_tpl, spec);\n        this.element = $(html);\n        let input_elem = this.element.find('input[type=\"file\"]');\n\n        const ignore_keys = {\n            'label': '',\n            'invalid_feedback': '',\n            'valid_feedback': '',\n            'help_text': '',\n            'placeholder': ''\n        };\n        for (let key in this.spec) {\n            if (key in ignore_keys) continue;\n            input_elem.attr(key, this.spec[key]);\n        }\n\n        // 文件选中后先不通知后端\n        let that = this;\n        input_elem.on('change', function () {\n            let file = (input_elem[0] as HTMLInputElement).files[0];\n            let fr = new FileReader();\n            fr.onload = function () {\n                that.data_url_value = {\n                    'filename': file.name,\n                    'dataurl': fr.result as string\n                };\n                console.log(that.data_url_value);\n            };\n            fr.readAsDataURL(file);\n        });\n        //  todo 通过回调的方式调用init\n        setTimeout(bsCustomFileInput.init, state.ShowDuration + 100);\n\n        return this.element;\n    }\n\n    update_input(spec: any): any {\n        let attributes = spec.attributes;\n        this.update_input_helper(-1, attributes);\n    }\n\n    get_value(): any {\n        return this.data_url_value;\n    }\n}\n\n\n\n","import {Input} from \"./input\"\nimport {Actions} from \"./actions\"\nimport {CheckboxRadio} from \"./checkbox_radio\"\nimport {Textarea} from \"./textarea\"\nimport {File} from \"./file\"\n\n\nexport const all_input_items = [Input, Actions, CheckboxRadio, Textarea, File];","import {InputItem} from \"./base\";\nimport {Session} from \"../../session\";\nimport {deep_copy} from \"../../utils\"\n\nconst common_input_tpl = `\n<div class=\"form-group\">\n    {{#label}}<label for=\"{{id_name}}\">{{label}}</label>{{/label}}\n    <input type=\"{{type}}\" id=\"{{id_name}}\" aria-describedby=\"{{id_name}}_help\"  {{#list}}list=\"{{list}}\"{{/list}} class=\"form-control\" >\n    <datalist id=\"{{id_name}}-list\">\n        {{#datalist}} \n        <option>{{.}}</option> \n        {{/datalist}}\n    </datalist>\n    <div class=\"invalid-feedback\">{{invalid_feedback}}</div>  <!-- input 添加 is-invalid 类 -->\n    <div class=\"valid-feedback\">{{valid_feedback}}</div> <!-- input 添加 is-valid 类 -->\n    <small id=\"{{id_name}}_help\" class=\"form-text text-muted\">{{help_text}}</small>\n</div>`;\nconst select_input_tpl = `\n<div class=\"form-group\">\n    {{#label}}<label for=\"{{id_name}}\">{{label}}</label>{{/label}}\n    <select id=\"{{id_name}}\" aria-describedby=\"{{id_name}}_help\" class=\"form-control\" {{#multiple}}multiple{{/multiple}}>\n        {{#options}}\n        <option value=\"{{value}}\" {{#selected}}selected{{/selected}} {{#disabled}}disabled{{/disabled}}>{{label}}</option>\n        {{/options}}\n    </select>\n    <div class=\"invalid-feedback\">{{invalid_feedback}}</div>\n    <div class=\"valid-feedback\">{{valid_feedback}}</div>\n    <small id=\"{{id_name}}_help\" class=\"form-text text-muted\">{{help_text}}</small>\n</div>`;\n\nexport class Input extends InputItem {\n    static accept_input_types: string[] = [\"text\", \"password\", \"number\", \"color\", \"date\", \"range\", \"time\", \"select\"];\n\n    constructor(session: Session, task_id: string, spec: any) {\n        super(session, task_id, spec);\n    }\n\n    create_element(): JQuery {\n        let spec = deep_copy(this.spec);\n        const id_name = spec.name + '-' + Math.floor(Math.random() * Math.floor(9999));\n        spec['id_name'] = id_name;\n        if (spec.datalist)\n            spec['list'] = id_name + '-list';\n\n        let html;\n        if (spec.type === 'select')\n            html = Mustache.render(select_input_tpl, spec);\n        else\n            html = Mustache.render(common_input_tpl, spec);\n\n        this.element = $(html);\n        let input_elem = this.element.find('#' + id_name);\n\n        // blur事件时，发送当前值到服务器\n        input_elem.on(\"blur\", (e) => {\n            this.send_value_listener(this, e)\n        });\n\n        // 将额外的html参数加到input标签上\n        const ignore_keys = {\n            'type': '',\n            'label': '',\n            'invalid_feedback': '',\n            'valid_feedback': '',\n            'help_text': '',\n            'options': '',\n            'datalist': '',\n            'multiple': ''\n        };\n        for (let key in this.spec) {\n            if (key in ignore_keys) continue;\n            input_elem.attr(key, this.spec[key]);\n        }\n\n        return this.element;\n    }\n\n    update_input(spec: any): any {\n        let attributes = spec.attributes;\n\n        this.update_input_helper(-1, attributes);\n    }\n\n    get_value(): any {\n        return this.element.find('input,select').val();\n    }\n}\n\n","import {InputItem} from \"./base\";\nimport {Session} from \"../../session\";\nimport {deep_copy, make_set} from \"../../utils\"\nimport {config as appConfig, state} from \"../../state\";\n\n\nconst textarea_input_tpl = `\n<div class=\"form-group\">\n    {{#label}}<label for=\"{{id_name}}\">{{label}}</label>{{/label}}\n    <textarea id=\"{{id_name}}\" aria-describedby=\"{{id_name}}_help\" rows=\"{{rows}}\" class=\"form-control\" >{{value}}</textarea>\n    <div class=\"invalid-feedback\">{{invalid_feedback}}</div>  <!-- input 添加 is-invalid 类 -->\n    <div class=\"valid-feedback\">{{valid_feedback}}</div> <!-- input 添加 is-valid 类 -->\n    <small id=\"{{id_name}}_help\" class=\"form-text text-muted\">{{help_text}}</small>\n</div>`;\n\n\nexport class Textarea extends InputItem {\n    static accept_input_types: string[] = [\"textarea\"];\n\n    private code_mirror: any = null;\n\n    constructor(session: Session, task_id: string, spec: any) {\n        super(session, task_id, spec);\n    }\n\n    create_element() {\n        let that = this;\n\n        let spec = deep_copy(this.spec);\n        const id_name = spec.name + '-' + Math.floor(Math.random() * Math.floor(9999));\n        spec['id_name'] = id_name;\n        let html = Mustache.render(textarea_input_tpl, spec);\n        this.element = $(html);\n        let input_elem = this.element.find('#' + id_name);\n\n        // blur事件时，发送当前值到服务器\n        // input_elem.on('blur', this.send_value_listener);\n\n        // 将额外的html参数加到input标签上\n        const ignore_keys = make_set(['value', 'type', 'label', 'invalid_feedback', 'valid_feedback', 'help_text', 'rows', 'code']);\n        for (let key in this.spec) {\n            if (key in ignore_keys) continue;\n            input_elem.attr(key, this.spec[key]);\n        }\n        if (spec.code) {\n            CodeMirror.modeURL = appConfig.codeMirrorModeURL;\n\n            let config: { [name: string]: any } = {\n                'theme': 'base16-light',\n                'mode': 'python',\n                'lineNumbers': true,  // 显示行数\n                'indentUnit': 4,  //缩进单位为4\n                'styleActiveLine': true,  // 当前行背景高亮\n                'matchBrackets': true,  //括号匹配\n                'lineWrapping': true,  //自动换行\n            };\n            for (let k in that.spec.code)\n                config[k] = that.spec.code[k];\n\n            if (config.theme && config.theme !== 'base16-light')\n                Textarea.load_codemirror_theme(config.theme);\n\n            setTimeout(function () {  // 需要等待当前表单被添加到文档树中后，再初始化CodeMirror，否则CodeMirror样式会发生错误\n                that.code_mirror = CodeMirror.fromTextArea(that.element.find('textarea')[0], config);\n                CodeMirror.autoLoadMode(that.code_mirror, config.mode);\n                that.code_mirror.setSize(null, 20 * that.spec.rows);\n            }, 100);\n\n            setTimeout(function () {  // 需要等待当前表单显示后，重新计算表单高度\n                // 重新计算表单高度\n                that.element.parents('.card').height('auto');\n            }, state.ShowDuration);\n        }\n\n        return this.element;\n    };\n\n    update_input(spec: any) {\n        let attributes = spec.attributes;\n\n        this.update_input_helper.call(this, -1, attributes);\n    };\n\n    get_value() {\n        return this.element.find('textarea').val();\n    };\n\n    static load_codemirror_theme(theme: string, url_tpl = appConfig.codeMirrorThemeURL) {\n        let cssId = 'codemirror_theme_' + theme;  // you could encode the css path itself to generate id..\n        if (!document.getElementById(cssId)) {\n            let head = document.getElementsByTagName('head')[0];\n            let link = document.createElement('link');\n            link.id = cssId;\n            link.rel = 'stylesheet';\n            link.type = 'text/css';\n            link.href = url_tpl.replace('%N', theme);\n            link.media = 'all';\n            head.appendChild(link);\n        }\n    }\n}\n\n\n\n","import {state} from '../state'\nimport {b64toBlob} from \"../utils\";\n\n/*\n* 当前限制\n* 若外层为layout类的Widget，则内层Widget在get_element中绑定的事件将会失效\n* */\n\nexport interface Widget {\n    handle_type: string;\n\n    get_element(spec: any): JQuery;\n}\n\nlet Text = {\n    handle_type: 'text',\n    get_element: function (spec: any): JQuery {\n        let elem = spec.inline ? $('<span></span>') : $('<p></p>');\n        spec.content = spec.content.replace(/ /g, '\\u00A0');\n        // make '\\n' to <br/>\n        let lines = (spec.content || '').split('\\n');\n        for (let idx = 0; idx < lines.length - 1; idx++)\n            elem.append(document.createTextNode(lines[idx])).append('<br/>');\n        elem.append(document.createTextNode(lines[lines.length - 1]));\n        return elem;\n    }\n};\n\nlet _md_parser = new Mditor.Parser();\nlet Markdown = {\n    handle_type: 'markdown',\n    get_element: function (spec: any) {\n        return $(_md_parser.parse(spec.content));\n    }\n};\n\n// 将html字符串解析成jQuery对象\nfunction parseHtml(html_str: string) {\n    let nodes = $.parseHTML(html_str, null, true);\n    let elem;\n    if (nodes.length != 1)\n        elem = $(document.createElement('div')).append(nodes);\n    else\n        elem = $(nodes[0]);\n    return elem;\n}\n\nlet Html = {\n    handle_type: 'html',\n    get_element: function (spec: any) {\n        return parseHtml(spec.content);\n    }\n};\n\nlet Buttons = {\n    handle_type: 'buttons',\n    get_element: function (spec: any) {\n        const btns_tpl = `<div>{{#buttons}}\n                             <button value=\"{{value}}\" onclick=\"WebIO.DisplayAreaButtonOnClick(this, '{{callback_id}}')\" class=\"btn btn-primary {{#small}}btn-sm{{/small}}\">{{label}}</button> \n                          {{/buttons}}</div>`;\n        let html = Mustache.render(btns_tpl, spec);\n        return $(html);\n    }\n};\n\n// 显示区按钮点击回调函数\nexport function DisplayAreaButtonOnClick(this_ele: HTMLElement, callback_id: string) {\n    if (state.CurrentSession === null)\n        return console.error(\"can't invoke DisplayAreaButtonOnClick when WebIOController is not instantiated\");\n\n    let val = $(this_ele).val();\n    state.CurrentSession.send_message({\n        event: \"callback\",\n        task_id: callback_id,\n        data: val\n    });\n}\n\nlet File = {\n    handle_type: 'file',\n    get_element: function (spec: any) {\n        const html = `<div><button type=\"button\" class=\"btn btn-link\">${spec.name}</button></div>`;\n        let element = $(html);\n        let blob = b64toBlob(spec.content);\n        element.on('click', 'button', function (e) {\n            saveAs(blob, spec.name, {}, false);\n        });\n\n        return element;\n    }\n};\n\n// 将output指令的spec字段解析成html字符串\nfunction outputSpecToHtml(spec: any) {\n    let html = '';\n    try {\n        let nodes = getWidgetElement(spec);\n        for (let node of nodes)\n            html += node.outerHTML || '';\n    } catch (e) {\n        console.error('Get sub widget html error,', e, spec);\n    }\n    return html;\n}\n\nlet Table = {\n    handle_type: 'table',\n    get_element: function (spec: { data: string[][], span: { [i: string]: { col: number, row: number } } }) {\n        const table_tpl = `\n<table>\n    <tr>\n        {{#header}} \n        <th{{#col}} colspan=\"{{col}}\"{{/col}}{{#row}} rowspan=\"{{row}}\"{{/row}}>{{& data}}</th> \n        {{/header}}\n    </tr>\n      {{#tdata}} \n      <tr>\n        {{# . }} \n        <td{{#col}} colspan=\"{{col}}\"{{/col}}{{#row}} rowspan=\"{{row}}\"{{/row}}>{{& data}}</td> \n        {{/ . }} \n      </tr>\n      {{/tdata}}\n    \n</table>`;\n\n        interface itemType {\n            data: string,\n            col?: number,\n            row?: number\n        }\n\n        // 将spec转化成模版引擎的输入\n        let table_data: itemType[][] = [];\n        for (let row_id in spec.data) {\n            table_data.push([]);\n            let row = spec.data[row_id];\n            for (let col_id in row) {\n                let data = spec.data[row_id][col_id];\n\n                // 处理复合类型单元格，即单元格不是简单的html，而是一个output命令的spec\n                if (typeof data === 'object') {\n                    data = outputSpecToHtml(data);\n                }\n\n                table_data[row_id].push({\n                    data: data,\n                    ...(spec.span[row_id + ',' + col_id] || {})\n                });\n            }\n        }\n\n        let header: itemType[], data: itemType[][];\n        [header, ...data] = table_data;\n        let html = Mustache.render(table_tpl, {header: header, tdata: data});\n        return $(html);\n    }\n};\n\nlet CustomWidget = {\n    handle_type: 'custom_widget',\n    get_element: function (spec: { template: string, data: { [i: string]: any } }) {\n        spec.data['pywebio_output_parse'] = function () {\n            if (this.type)\n                return outputSpecToHtml(this);\n            else\n                return this\n        };\n        let html = Mustache.render(spec.template, spec.data);\n        return parseHtml(html);\n    }\n};\n\nlet all_widgets: Widget[] = [Text, Markdown, Html, Buttons, File, Table, CustomWidget];\n\n\nlet type2widget: { [i: string]: Widget } = {};\nfor (let w of all_widgets)\n    type2widget[w.handle_type] = w;\n\nexport function getWidgetElement(spec: any) {\n    if (!(spec.type in type2widget))\n        throw Error(\"Unknown type in getWidgetElement() :\" + spec.type);\n\n    return type2widget[spec.type].get_element(spec);\n}\n\n\n\n\n","export interface Command {\n    command: string\n    task_id: string\n    spec: any\n}\n\nexport interface ClientEvent {\n    event: string,\n    task_id: string,\n    data: any\n}\n\n\n/*\n* 会话\n* 向外暴露的事件：on_session_create、on_session_close、on_server_message\n* 提供的函数：start_session、send_message、close_session\n* */\nexport interface Session {\n    on_session_create(callback: () => void): void;\n\n    on_session_close(callback: () => void): void;\n\n    on_server_message(callback: (msg: Command) => void): void;\n\n    start_session(debug: boolean): void;\n\n    send_message(msg: ClientEvent): void;\n\n    close_session(): void;\n\n    closed(): boolean;\n}\n\nexport class WebSocketSession implements Session {\n    ws: WebSocket;\n    debug: boolean;\n    private _closed: boolean;\n    private _on_session_create: (this: WebSocket, ev: Event) => any = ()=>{};\n    private _on_session_close: (this: WebSocket, ev: CloseEvent) => any = ()=>{};\n    private _on_server_message: (msg: Command) => any = ()=>{};\n\n    constructor(public ws_api: string, app_name: string = 'index') {\n        this.ws = null;\n        this.debug = false;\n        this._closed = false;\n\n        let url = new URL(ws_api);\n        if (url.protocol !== 'wss:' && url.protocol !== 'ws:') {\n            let protocol = url.protocol || window.location.protocol;\n            url.protocol = protocol.replace('https', 'wss').replace('http', 'ws');\n        }\n        url.search = \"?app=\" + app_name;\n        this.ws_api = url.href;\n    }\n\n    on_session_create(callback: () => any): void {\n        this._on_session_create = callback;\n    };\n\n    on_session_close(callback: () => any): void {\n        this._on_session_close = callback;\n    }\n\n    on_server_message(callback: (msg: Command) => any): void {\n        this._on_server_message = callback;\n    }\n\n    start_session(debug: boolean = false): void {\n        this.debug = debug;\n        this.ws = new WebSocket(this.ws_api);\n        this.ws.onopen = this._on_session_create;\n        this.ws.onclose = this._on_session_close;\n        let that = this;\n        this.ws.onmessage = function (evt) {\n            let msg: Command = JSON.parse(evt.data);\n            if (debug) console.info('>>>', msg);\n            that._on_server_message(msg);\n        };\n    }\n\n    send_message(msg: ClientEvent): void {\n        if (this.closed())\n            return alert(\"与服务器连接已断开，请刷新页面重新操作\");\n\n        if (this.ws === null)\n            return console.error('WebSocketWebIOSession.ws is null when invoke WebSocketWebIOSession.send_message. ' +\n                'Please call WebSocketWebIOSession.start_session first');\n        this.ws.send(JSON.stringify(msg));\n        if (this.debug) console.info('<<<', msg);\n    }\n\n    close_session(): void {\n        this._closed = true;\n        this._on_session_close.call(this.ws, null);\n        try {\n            this.ws.close()\n        } catch (e) {\n        }\n    }\n\n    closed(): boolean {\n        return this._closed || this.ws.readyState === WebSocket.CLOSED || this.ws.readyState === WebSocket.CLOSING;\n    }\n}\n\n\nexport class HttpSession implements Session {\n    interval_pull_id: number = null;\n    webio_session_id: string;\n    debug = false;\n\n    private _closed = false;\n    private _on_session_create: () => void = ()=>{};\n    private _on_session_close: () => void = ()=>{};\n    private _on_server_message: (msg: Command) => void = ()=>{};\n\n\n    constructor(public api_url: string, app_name = 'index', public pull_interval_ms = 1000) {\n        let url = new URL(api_url, window.location.href);\n        url.search = \"?app=\" + app_name;\n        this.api_url = url.href;\n    }\n\n    on_session_create(callback: () => void): void {\n        this._on_session_create = callback;\n    }\n\n    on_session_close(callback: () => void): void {\n        this._on_session_close = callback;\n    }\n\n    on_server_message(callback: (msg: Command) => void): void {\n        this._on_server_message = callback;\n    }\n\n    start_session(debug: boolean = false): void {\n        this.debug = debug;\n        let that = this;\n\n        function pull() {\n            $.ajax({\n                type: \"GET\",\n                url: that.api_url,\n                contentType: \"application/json; charset=utf-8\",\n                dataType: \"json\",\n                headers: {\"webio-session-id\": that.webio_session_id},\n                success: function (data: Command[], textStatus: string, jqXHR: JQuery.jqXHR) {\n                    that._on_request_success(data, textStatus, jqXHR);\n                    that._on_session_create();\n                },\n                error: function () {\n                    console.error('Http pulling failed');\n                }\n            })\n        }\n\n        pull();\n        this.interval_pull_id = setInterval(pull, this.pull_interval_ms);\n    }\n\n    private _on_request_success(data: Command[], textStatus: string, jqXHR: JQuery.jqXHR) {\n        let sid = jqXHR.getResponseHeader('webio-session-id');\n        if (sid) this.webio_session_id = sid;\n\n        for (let msg of data) {\n            if (this.debug) console.info('>>>', msg);\n            this._on_server_message(msg);\n        }\n    };\n\n    send_message(msg: ClientEvent): void {\n        if (this.closed())\n            return alert(\"与服务器连接已断开，请刷新页面重新操作\");\n\n        if (this.debug) console.info('<<<', msg);\n        $.ajax({\n            type: \"POST\",\n            url: this.api_url,\n            data: JSON.stringify(msg),\n            contentType: \"application/json; charset=utf-8\",\n            dataType: \"json\",\n            headers: {\"webio-session-id\": this.webio_session_id},\n            success: this._on_request_success.bind(this),\n            error: function () {  // todo\n                console.error('Http push event failed, event data: %s', msg);\n            }\n        })\n    }\n\n    close_session(): void {\n        this._closed = true;\n        this._on_session_close();\n        clearInterval(this.interval_pull_id);\n    }\n\n    closed(): boolean {\n        return this._closed;\n    }\n}\n\n/*\n* Check given `backend_addr` is a http backend\n* Usage:\n*   // `http_backend` is a boolean to present whether or not a http_backend the given `backend_addr` is\n*   is_http_backend('http://localhost:8080/io').then(function(http_backend){ });\n* */\nexport function is_http_backend(backend_addr: string) {\n    let url = new URL(backend_addr);\n    let protocol = url.protocol || window.location.protocol;\n    url.protocol = protocol.replace('wss', 'https').replace('ws', 'http');\n    backend_addr = url.href;\n\n    return new Promise(function (resolve, reject) {\n        $.get(backend_addr, {test: 1}, undefined, 'html').done(function (data: string) {\n            resolve(data === 'ok');\n        }).fail(function (e: JQuery.jqXHR) {\n            resolve(false);\n        });\n    });\n}","import {HttpSession, Session} from \"./session\";\n\n// 运行时状态\nexport let state = {\n    AutoScrollBottom: true,  // 是否有新内容时自动滚动到底部\n    OutputFixedHeight: false,  // 是否固定输出区域宽度\n    CurrentSession: null as Session,  // 当前正在活跃的会话\n    ShowDuration: 200,  // ms, 显示表单的过渡动画时长\n};\n\n// 应用配置\nexport let config = {\n    codeMirrorModeURL: \"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/mode/%N/%N.min.js\",\n    codeMirrorThemeURL: \"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.52.2/theme/%N.min.css\",\n    outputAnimation: true, // 启用内容输出动画\n    httpPullInterval: 1000,  // HttpSession 拉取消息的周期（ms）\n    debug: false,  // 调试模式， 打印所有交互的消息\n};\n","// Indexable Types\ninterface Dict {\n    [index: string]: any;\n}\n\nexport class LRUMap {\n    keys: string[] = [];\n    map: Dict = {};\n\n    push(key: string, value: any) {\n        if (key in this.map)\n            return console.error(\"LRUMap: key:%s already in map\", key);\n        this.keys.push(key);\n        this.map[key] = value;\n    };\n\n    get_value(key: string) {\n        return this.map[key];\n    };\n\n    get_top() {\n        let top_key = this.keys[this.keys.length - 1];\n        return this.map[top_key];\n    };\n\n    set_value(key: string, value: any) {\n        if (!(key in this.map))\n            return console.error(\"LRUMap: key:%s not in map when call `set_value`\", key);\n        this.map[key] = value;\n    };\n\n    move_to_top(key: string) {\n        const index = this.keys.indexOf(key);\n        if (index > -1) {\n            this.keys.splice(index, 1);\n            this.keys.push(key);\n        } else {\n            return console.error(\"LRUMap: key:%s not in map when call `move_to_top`\", key);\n        }\n    };\n\n    remove(key: string) {\n        if (key in this.map) {\n            delete this.map[key];\n            this.keys.splice(this.keys.indexOf(key), 1);\n        } else {\n            return console.error(\"LRUMap: key:%s not in map when call `remove`\", key);\n        }\n    };\n\n}\n\n\nexport function b64toBlob(b64Data: string, contentType = 'application/octet-stream', sliceSize = 512) {\n    const byteCharacters = atob(b64Data);\n    const byteArrays = [];\n\n    for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {\n        const slice = byteCharacters.slice(offset, offset + sliceSize);\n\n        const byteNumbers = new Array(slice.length);\n        for (let i = 0; i < slice.length; i++) {\n            byteNumbers[i] = slice.charCodeAt(i);\n        }\n\n        const byteArray = new Uint8Array(byteNumbers);\n        byteArrays.push(byteArray);\n    }\n\n    const blob = new Blob(byteArrays, {type: contentType});\n    return blob;\n}\n\nexport function make_set(arr: string[]) {\n    let set: { [i: string]: string } = {};\n    for (let val of arr)\n        set[val] = '';\n    return set;\n}\n\nexport function deep_copy(obj: any): any {\n    return JSON.parse(JSON.stringify(obj));\n}\n\n\n// container 为带有滚动条的元素\nexport function body_scroll_to(target: JQuery, position = 'top', complete?: (this: HTMLElement) => void, offset = 0) {\n    let scrollTop = null;\n    if (position === 'top')\n        scrollTop = target.offset().top;\n    else if (position === 'middle')\n        scrollTop = target.offset().top + 0.5 * target[0].clientHeight - 0.5 * $(window).height();\n    else if (position === 'bottom')\n        scrollTop = target[0].clientHeight + target.offset().top - $(window).height();\n\n    let container = $('body,html');\n    let speed = Math.abs(container.scrollTop() - scrollTop - offset);\n    if (scrollTop !== null)\n        container.stop().animate({scrollTop: scrollTop + offset}, Math.min(speed, 500) + 100, complete);\n}\n\n// container 为带有滚动条的元素\nexport function box_scroll_to(target: JQuery, container: JQuery, position = 'top', complete?: (this: HTMLElement) => void, offset = 0) {\n    let scrollTopOffset = null;\n    if (position === 'top')\n        scrollTopOffset = target[0].getBoundingClientRect().top - container[0].getBoundingClientRect().top;\n    else if (position === 'middle')\n        scrollTopOffset = target[0].getBoundingClientRect().top - container[0].getBoundingClientRect().top - container.height() * 0.5 + target.height() * 0.5;\n    else if (position === 'bottom')\n        scrollTopOffset = target[0].getBoundingClientRect().bottom - container[0].getBoundingClientRect().bottom;\n\n    let speed = Math.min(Math.abs(scrollTopOffset + offset), 500) + 100;\n    if (scrollTopOffset !== null)\n        container.stop().animate({scrollTop: container.scrollTop() + scrollTopOffset + offset}, speed, complete);\n}\n\n\nexport function randomid(length: number) {\n    let result = '';\n    let characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    let charactersLength = characters.length;\n    for (let i = 0; i < length; i++) {\n        result += characters.charAt(Math.floor(Math.random() * charactersLength));\n    }\n    return result;\n}\n"]}